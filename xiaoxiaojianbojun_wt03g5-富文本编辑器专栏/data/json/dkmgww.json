{
  "body_html": "<!doctype html><div class=\"lake-content\" typography=\"classic\"><h1 id=\"3cc59957\"><span class=\"ne-text\">原生API编写简单富文本编辑器002</span></h1><p id=\"uc0d55e5a\" class=\"ne-p\"><br></p><h2 id=\"2390352b\"><span class=\"ne-text\">1. 为功能按钮添加点击事件</span></h2><p id=\"u5001c48c\" class=\"ne-p\"><br></p><p id=\"ub8bdb0de\" class=\"ne-p\"><span class=\"ne-text\">我们在</span><code class=\"ne-code\"><span class=\"ne-text\">index.js</span></code><span class=\"ne-text\"> 中为所有功能按钮添加点击事件监听，在点击对应按钮时执行相应的原生命令。</span></p><p id=\"uaefabc31\" class=\"ne-p\"><br></p><pre data-language=\"javascript\" id=\"92842a9b\" class=\"ne-codeblock language-javascript\">window.onload= function() {\n    const btns = document.getElementById('editorBar').getElementsByTagName('li');\n    for (let i=0; i&lt;btns.length; i++) {\n        const btn = btns[i];\n        const command = btn.getAttribute('command');\n        btn.onclick= function() {\n            document.execCommand(command, false, '');\n        };\n    }\n};</pre><p id=\"ub31a6576\" class=\"ne-p\"><br></p><p id=\"uc827e777\" class=\"ne-p\"><span class=\"ne-text\">然后我们回到页面中进行点击，会发现除了重做和撤销，其它按钮都不起作用，哪怕我们在可编辑区域输入文字，选择一段文字，然后点击按钮，也是没有任何效果。（可在</span><code class=\"ne-code\"><span class=\"ne-text\">1.0.2</span></code><span class=\"ne-text\">分支复现）</span></p><p id=\"ue66f1276\" class=\"ne-p\"><br></p><p id=\"u1ffc7637\" class=\"ne-p\"><span class=\"ne-text\">原因是：</span></p><p id=\"u57e229e7\" class=\"ne-p\"><br></p><div class=\"ne-quote\"><p id=\"uc62a9a4f\" class=\"ne-p\"><code class=\"ne-code\"><span class=\"ne-text\">document.execCommand</span></code><span class=\"ne-text\"> 命令只有使用</span><code class=\"ne-code\"><span class=\"ne-text\">button</span></code><span class=\"ne-text\">元素触发才能生效。</span></p></div><p id=\"ua99560f9\" class=\"ne-p\"><br></p><h2 id=\"d8880d6b\"><span class=\"ne-text\">2. 改造HTML</span></h2><p id=\"uec9c209f\" class=\"ne-p\"><br></p><p id=\"uc1155280\" class=\"ne-p\"><span class=\"ne-text\">所以，我们改造一下HTML，将按钮全部改为</span><code class=\"ne-code\"><span class=\"ne-text\">button</span></code><span class=\"ne-text\">元素：</span></p><p id=\"u948d381a\" class=\"ne-p\"><br></p><pre data-language=\"html\" id=\"f8d35831\" class=\"ne-codeblock language-html\">&lt;!--&gt; index.html &lt;--&gt;\n\n&lt;ul&gt;\n    &lt;li&gt;&lt;button command=&quot;undo&quot;&gt;&lt;i class=&quot;iconfont icon-chexiao&quot; title=&quot;撤销&quot;&gt;&lt;/i&gt;&lt;/button&gt;&lt;/li&gt;\n    &lt;li&gt;&lt;button command=&quot;redo&quot;&gt;&lt;i class=&quot;iconfont icon-zhongzuo&quot; title=&quot;重做&quot;&gt;&lt;/i&gt;&lt;/button&gt;&lt;/li&gt;\n    &lt;li&gt;&lt;button command=&quot;copy&quot;&gt;&lt;i class=&quot;iconfont icon-fuzhi&quot; title=&quot;复制&quot;&gt;&lt;/i&gt;&lt;/button&gt;&lt;/li&gt;\n    &lt;li&gt;&lt;button command=&quot;cut&quot;&gt;&lt;i class=&quot;iconfont icon-jianqie&quot; title=&quot;剪切&quot;&gt;&lt;/i&gt;&lt;/button&gt;&lt;/li&gt;\n    &lt;li&gt;&lt;button command=&quot;fontName&quot;&gt;&lt;i class=&quot;iconfont icon-ziti&quot; title=&quot;字体&quot;&gt;&lt;/i&gt;&lt;/button&gt;&lt;/li&gt;\n    &lt;li&gt;&lt;button command=&quot;fontSize&quot;&gt;&lt;i class=&quot;iconfont icon-zihao&quot; title=&quot;字号&quot;&gt;&lt;/i&gt;&lt;/button&gt;&lt;/li&gt;\n    &lt;li&gt;&lt;button command=&quot;bold&quot;&gt;&lt;i class=&quot;iconfont icon-zitijiacu&quot; title=&quot;加粗&quot;&gt;&lt;/i&gt;&lt;/button&gt;&lt;/li&gt;\n    &lt;li&gt;&lt;button command=&quot;italic&quot;&gt;&lt;i class=&quot;iconfont icon-zitixieti&quot; title=&quot;斜体&quot;&gt;&lt;/i&gt;&lt;/button&gt;&lt;/li&gt;\n    &lt;li&gt;&lt;button command=&quot;underline&quot;&gt;&lt;i class=&quot;iconfont icon-zitixiahuaxian&quot; title=&quot;下划线&quot;&gt;&lt;/i&gt;&lt;/button&gt;&lt;/li&gt;\n                    &lt;li&gt;&lt;button command=&quot;strikeThrough&quot;&gt;&lt;i class=&quot;iconfont icon-zitishanchuxian&quot; title=&quot;删除线&quot;&gt;&lt;/i&gt;&lt;/button&gt;&lt;/li&gt;\n                    &lt;li&gt;&lt;button command=&quot;superscript&quot;&gt;&lt;i class=&quot;iconfont icon-zitishangbiao&quot; title=&quot;上标&quot;&gt;&lt;/i&gt;&lt;/button&gt;&lt;/li&gt;\n                    &lt;li&gt;&lt;button command=&quot;subscript&quot;&gt;&lt;i class=&quot;iconfont icon-zitixiabiao&quot; title=&quot;下标&quot;&gt;&lt;/i&gt;&lt;/button&gt;&lt;/li&gt;\n                    &lt;li&gt;&lt;button command=&quot;fontColor&quot;&gt;&lt;i class=&quot;iconfont icon-qianjingse&quot; title=&quot;字体颜色&quot;&gt;&lt;/i&gt;&lt;/button&gt;&lt;/li&gt;\n                    &lt;li&gt;&lt;button command=&quot;backColor&quot;&gt;&lt;i class=&quot;iconfont icon-zitibeijingse&quot; title=&quot;字体背景色&quot;&gt;&lt;/i&gt;&lt;/button&gt;&lt;/li&gt;\n                    &lt;li&gt;&lt;button command=&quot;removeFormat&quot;&gt;&lt;i class=&quot;iconfont icon-qingchugeshi&quot; title=&quot;清除格式&quot;&gt;&lt;/i&gt;&lt;/button&gt;&lt;/li&gt;\n                    &lt;li&gt;&lt;button command=&quot;insertOrderedList&quot;&gt;&lt;i class=&quot;iconfont icon-youxuliebiao&quot; title=&quot;有序列表&quot;&gt;&lt;/i&gt;&lt;/button&gt;&lt;/li&gt;\n                    &lt;li&gt;&lt;button command=&quot;insertUnorderedList&quot;&gt;&lt;i class=&quot;iconfont icon-wuxuliebiao&quot; title=&quot;无序列表&quot;&gt;&lt;/i&gt;&lt;/button&gt;&lt;/li&gt;\n                    &lt;li&gt;&lt;button command=&quot;justifyLeft&quot;&gt;&lt;i class=&quot;iconfont icon-juzuoduiqi&quot; title=&quot;局左对齐&quot;&gt;&lt;/i&gt;&lt;/button&gt;&lt;/li&gt;\n                    &lt;li&gt;&lt;button command=&quot;justifyRight&quot;&gt;&lt;i class=&quot;iconfont icon-juyouduiqi&quot; title=&quot;居右对齐&quot;&gt;&lt;/i&gt;&lt;/button&gt;&lt;/li&gt;\n                    &lt;li&gt;&lt;button command=&quot;justifyCenter&quot;&gt;&lt;i class=&quot;iconfont icon-juzhongduiqi&quot; title=&quot;居中对齐&quot;&gt;&lt;/i&gt;&lt;/button&gt;&lt;/li&gt;\n                    &lt;li&gt;&lt;button command=&quot;justifyFull&quot;&gt;&lt;i class=&quot;iconfont icon-liangduanduiqi&quot; title=&quot;两端对齐&quot;&gt;&lt;/i&gt;&lt;/button&gt;&lt;/li&gt;\n                    &lt;li&gt;&lt;button command=&quot;createLink&quot;&gt;&lt;i class=&quot;iconfont icon-charulianjie&quot; title=&quot;插入链接&quot;&gt;&lt;/i&gt;&lt;/button&gt;&lt;/li&gt;\n                    &lt;li&gt;&lt;button command=&quot;unlink&quot;&gt;&lt;i class=&quot;iconfont icon-quxiaolianjie&quot; title=&quot;取消链接&quot;&gt;&lt;/i&gt;&lt;/button&gt;&lt;/li&gt;\n                    &lt;li&gt;&lt;button command=&quot;indent&quot;&gt;&lt;i class=&quot;iconfont icon-shouhangsuojin&quot; title=&quot;首行缩进&quot;&gt;&lt;/i&gt;&lt;/button&gt;&lt;/li&gt;\n                    &lt;li&gt;&lt;button command=&quot;insertImage&quot;&gt;&lt;i class=&quot;iconfont icon-tupian&quot; title=&quot;插入图片&quot;&gt;&lt;/i&gt;&lt;/button&gt;&lt;/li&gt;\n                &lt;/ul&gt;</pre><p id=\"u258b423a\" class=\"ne-p\"><br></p><h2 id=\"95c50c98\"><span class=\"ne-text\">3. 改造CSS</span></h2><p id=\"uf11545f1\" class=\"ne-p\"><br></p><p id=\"u738541b6\" class=\"ne-p\"><span class=\"ne-text\">由于将原来的元素上套了一层</span><code class=\"ne-code\"><span class=\"ne-text\">button</span></code><span class=\"ne-text\">元素，所以样式与我们最初设计的有了出入：</span></p><p id=\"u59952da3\" class=\"ne-p\"><br></p><p id=\"ua7f57968\" class=\"ne-p\"><img src=\"https://gitee.com/hjb2722404/tuchuang/raw/master/img/202203111635140.png\" width=\"1126\" id=\"l0QIt\" class=\"ne-image\"></p><p id=\"uc11a9528\" class=\"ne-p\"><br></p><p id=\"u19260fb0\" class=\"ne-p\"><span class=\"ne-text\">我们通过为</span><code class=\"ne-code\"><span class=\"ne-text\">button</span></code><span class=\"ne-text\">元素增加CSS规则来修复：</span></p><p id=\"u28d582fa\" class=\"ne-p\"><br></p><pre data-language=\"css\" id=\"60b0a127\" class=\"ne-codeblock language-css\">/**index.css **/\n\n.editor-toolbar ul li button {\n    background-color: #fff;\n    border: none;\n    cursor: pointer;\n}</pre><p id=\"u6bd0ed00\" class=\"ne-p\"><br></p><h2 id=\"fae7cf7b\"><span class=\"ne-text\">4. 改造 JS</span></h2><p id=\"u0af0099a\" class=\"ne-p\"><br></p><p id=\"u9469ab20\" class=\"ne-p\"><span class=\"ne-text\">我们将点击事件监听加在</span><code class=\"ne-code\"><span class=\"ne-text\">button</span></code><span class=\"ne-text\">上，以代替原来的</span><code class=\"ne-code\"><span class=\"ne-text\">li</span></code><span class=\"ne-text\">上的监听：</span></p><p id=\"u50836c31\" class=\"ne-p\"><br></p><pre data-language=\"javascript\" id=\"ef32473a\" class=\"ne-codeblock language-javascript\">// index.js\nconst btns = document.getElementById('editorBar').getElementsByTagName('button');</pre><p id=\"ua37d1d61\" class=\"ne-p\"><br></p><p id=\"u2b2aed87\" class=\"ne-p\"><span class=\"ne-text\">然后，我们再在页面可编辑区域输入文本，并点击功能按钮，可以得到以下结果：（可在</span><code class=\"ne-code\"><span class=\"ne-text\">1.0.3</span></code><span class=\"ne-text\">分支上复现）</span></p><p id=\"u2f260124\" class=\"ne-p\"><br></p><ul class=\"ne-tl\"><li checked=\"true\" id=\"ueb988a93\"><span class=\"ne-text\">撤销、重做功能正确；</span></li></ul><ul class=\"ne-tl\"><li checked=\"true\" id=\"u3243b595\"><span class=\"ne-text\">复制、剪切、粘贴功能正确（其中粘贴时直接使用</span><code class=\"ne-code\"><span class=\"ne-text\">Ctrl+v</span></code><span class=\"ne-text\">）</span></li></ul><ul class=\"ne-tl\"><li id=\"u0b33dba4\"><span class=\"ne-text\">字体、字号、前景色、背景色、插入链接、取消链接按钮点击无反应</span></li></ul><ul class=\"ne-tl\"><li checked=\"true\" id=\"u39e22111\"><span class=\"ne-text\">加粗、斜体、下划线、删除线、上标、下标、清除格式在有选中文本时执行正确</span></li></ul><ul class=\"ne-tl\"><li checked=\"true\" id=\"u933982d8\"><span class=\"ne-text\">有序列表、无序列表、左对齐、右对齐、居中对齐、两端对齐 、首行缩进对光标所在行起作用</span></li></ul><ul class=\"ne-tl\"><li id=\"u00aec538\"><span class=\"ne-text\">插入图片点击后会在光标处添加一个空的</span><code class=\"ne-code\"><span class=\"ne-text\">img</span></code><span class=\"ne-text\">标签，表现在页面上是两个空格</span></li></ul><p id=\"ua011fd02\" class=\"ne-p\"><br></p><p id=\"u2d82e863\" class=\"ne-p\"><img src=\"https://gitee.com/hjb2722404/tuchuang/raw/master/img/202203111653349.png\" width=\"1041\" id=\"lgJCK\" class=\"ne-image\"></p><p id=\"u5111f129\" class=\"ne-p\"><br></p><p id=\"u1b8a0711\" class=\"ne-p\"><img src=\"https://gitee.com/hjb2722404/tuchuang/raw/master/img/202203111653265.png\" width=\"1626\" id=\"Z13Kl\" class=\"ne-image\"></p><p id=\"u092717a5\" class=\"ne-p\"><br></p><p id=\"u40fad4e6\" class=\"ne-p\"><span class=\"ne-text\">我们看到，上面的测试结果中，还有很多功能是没有反应的，这是因为这些功能都是需要参数的，我们下一节将实现它们。</span></p></div>",
  "slug": 80566609,
  "title": "富文本编辑器开发系列10——原生API编写简单富文本编辑器002"
}