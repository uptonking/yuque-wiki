{
  "body_html": "<!doctype html><a name=\"富文本编辑器开发系列——-code-Range-API--code--探究\"></a><h1 id=\"704a8893\">富文本编辑器开发系列——<code>Range API</code> 探究</h1><p><br /></p><p>[TOC]</p><p><br /></p><a name=\"基本属性\"></a><h2 id=\"43a262a5\">基本属性</h2><p><br /></p><p>为了方便观察<code>range</code>的基本属性，我们写以下测试代码：</p><p><br /></p><p><img src=\"https://gitee.com/hjb2722404/tuchuang/raw/master/img/20201210154455.png#alt=image-20200831214251078\" style=\"max-width: 600px;\" /></p><p><br /></p><p><a href=\"https://jshare.com.cn/selection/BtGfG1\" target=\"_blank\">在线测试</a></p><p><br /></p><p>我们选中一段文本，然后看页面的输出和控制台的输出。</p><p><br /></p><p><img src=\"https://gitee.com/hjb2722404/tuchuang/raw/master/img/20201210154526.png#alt=image-20200831214635853\" style=\"max-width: 600px;\" /></p><p><br /></p><p><img src=\"https://gitee.com/hjb2722404/tuchuang/raw/master/img/20201210154538.png#alt=image-20200831214813395\" style=\"max-width: 600px;\" /></p><p><br /></p><p><img src=\"https://raw.githubusercontent.com/hjb2722404/myimg/master/20200910092643.png#alt=image-20200831214844785\" style=\"max-width: 600px;\" /></p><p><br /></p><p>我们观察到它的几个属性：</p><p><br /></p><ul><li><code>collapsed</code>: 是否闭合，即当前选区是否是一个光标，只有开始节点与结束节点相同，并且开始偏移量与结束偏移量相同时才是<code>true</code>，此处未闭合，所以是<code>false</code>。</li></ul><ul><li><code>commonAncestorContainer</code>：返回包含开始节点与结束节点的最深一级的节点（根节点），此处是设置了<code>onclick</code>属性的<code>div</code>节点，注意，这里最深一级是指可编辑区域所包含的节点中的最深一级（并且不包含设置了<code>contenteditable</code>属性为<code>true</code>的节点本身。）</li></ul><ul><li><code>endContainer</code>:  结束节点，拖蓝结束点所在的<code>DOM</code> 节点，此处是多行文本所在的文本节点，注意，是文本节点，而不是包含它的<code>p</code> 节点。</li></ul><ul><li><code>endOffset</code> : 结束偏移量，即从结束节点的开始位置数起，到拖蓝结束位置所经过的字数。如果结束节点是一个包含子元素的<code>DOM</code>元素，则代表从该节点的第一个节点到拖蓝结束位置所在的节点所经过的节点数。</li></ul><ul><li><code>startContainer</code>：开始节点，拖蓝的起点所在的<code>DOM</code>节点，此处是<code>id</code>为<code>first</code>的<code>p</code>节点所包裹的文本节点，但又不包含其中<code>id</code>为<code>third</code>的<code>span</code>节点。</li></ul><ul><li><code>startOffset</code>：开始偏移量，即从开始节点的开始位置数起，到拖蓝开始位置所经过的字数。如果开始节点是一个包含子元素的<code>DOM</code>元素，则代表从该节点第一个节点到拖蓝开始位置所在的节点所经过的节点数。</li></ul><p><br /></p><p>对于<code>startContainer</code> 中的情况，我们可以再做一个实验来验证：</p><p><br /></p><p><img src=\"https://gitee.com/hjb2722404/tuchuang/raw/master/img/20201210154547.png#alt=image-20200831220732554\" style=\"max-width: 600px;\" /></p><p><br /></p><p>可以看到，这里开始节点是<code>这里是另一段普通的</code> 文本节点，而结束节点是<code>文字内容啊</code> 文本节点，虽然它们都在同一<code>p</code>节点中，但因为有<code>span</code> 节点的分割，它俩分别是独立的文本节点了。</p><p><br /></p><a name=\"成员方法\"></a><h2 id=\"b8f44d6c\">成员方法</h2><p><br /></p><a name=\"-code-setStart(startNode--startOffset)--code-\"></a><h3 id=\"8dce40b5\"><code>setStart(startNode, startOffset)</code></h3><p><br /></p><p>设置拖蓝的起点,<code>startNode</code>：开始节点，<code>startOffset</code>: 起点相对于开始节点开始位置的偏移量</p><p><br /></p><p><img src=\"https://gitee.com/hjb2722404/tuchuang/raw/master/img/20201210154559.gif#alt=rangeApi_setStart\" style=\"max-width: 600px;\" /></p><p><br /></p><p><a href=\"https://codesandbox.io/s/rangeapisetstart-h5ye5?fontsize=14&amp;hidenavigation=1&amp;theme=dark\" target=\"_blank\"><img src=\"https://codesandbox.io/static/img/play-codesandbox.svg#alt=Edit%20rangeAPI_setStart\" style=\"max-width: 600px;\" /></a></p><a name=\"-code-setEnd(endNode--endOffset)--code-\"></a><h3 id=\"e006cd30\"><code>setEnd(endNode, endOffset)</code></h3><p><br /></p><p>设置拖蓝的终点，<code>endNode</code>:结束节点， <code>endOffset</code>: 终点相对于结束节点开始位置的偏移量。</p><p><br /></p><p><img src=\"https://gitee.com/hjb2722404/tuchuang/raw/master/img/20201210154656.gif#alt=\" style=\"max-width: 600px;\" /></p><p><br /></p><p><a href=\"https://codesandbox.io/s/rangeapisetstartbefore-xye5b?fontsize=14&amp;hidenavigation=1&amp;theme=dark\" target=\"_blank\"><img src=\"https://codesandbox.io/static/img/play-codesandbox.svg#alt=Edit%20rangeAPI_setStartBefore\" style=\"max-width: 600px;\" /></a></p><a name=\"-code-setStartBefore(referenceNode)--code-\"></a><h3 id=\"3fb23134\"><code>setStartBefore(referenceNode)</code></h3><p><br /></p><p>相对于另一个节点来设置拖蓝的开始位置，该拖蓝的开始节点与另一个节点的父节点是同一个，开始节点在另一个节点之前</p><p><br /></p><p><img src=\"https://gitee.com/hjb2722404/tuchuang/raw/master/img/20201210154840.gif#alt=\" style=\"max-width: 600px;\" /></p><p><br /></p><p><a href=\"https://codesandbox.io/s/rangeapisetstartbefore-ck81v?fontsize=14&amp;hidenavigation=1&amp;theme=dark\" target=\"_blank\"><img src=\"https://codesandbox.io/static/img/play-codesandbox.svg#alt=Edit%20rangeAPI_setStartBefore\" style=\"max-width: 600px;\" /></a></p><a name=\"-code-setStartAfter(referenceNode)--code-\"></a><h3 id=\"8a55ce1e\"><code>setStartAfter(referenceNode)</code></h3><p><br /></p><p>相对于另一个节点来设置拖蓝的开始位置，该拖蓝的开始节点与另一个节点的父节点是同一个，开始节点在另一个节点之后.</p><p><br /></p><p><img src=\"https://gitee.com/hjb2722404/tuchuang/raw/master/img/20201210154901.gif#alt=\" style=\"max-width: 600px;\" /></p><p><br /></p><p><a href=\"https://codesandbox.io/s/rangeapisetstartafter-jw701?fontsize=14&amp;hidenavigation=1&amp;theme=dark\" target=\"_blank\"><img src=\"https://codesandbox.io/static/img/play-codesandbox.svg#alt=Edit%20rangeAPI_setStartAfter\" style=\"max-width: 600px;\" /></a></p><a name=\"-code-setEndBefore(referenceNode)--code-\"></a><h3 id=\"4c4bf62e\"><code>setEndBefore(referenceNode)</code></h3><p><br /></p><p>相对于另一个节点来设置拖蓝的结束位置，该拖蓝的结束节点与另一个节点的父节点是同一个，结束节点在另一个节点之前.</p><p><br /></p><p><img src=\"https://gitee.com/hjb2722404/tuchuang/raw/master/img/20201210154922.gif#alt=\" style=\"max-width: 600px;\" /></p><p><br /></p><p><a href=\"https://codesandbox.io/s/rangeapisetendbefore-qtn4x?fontsize=14&amp;hidenavigation=1&amp;theme=dark\" target=\"_blank\"><img src=\"https://codesandbox.io/static/img/play-codesandbox.svg#alt=Edit%20rangeAPI_setEndBefore\" style=\"max-width: 600px;\" /></a><a href=\"https://jshare.com.cn/selection/4PGffs\" target=\"_blank\">在线测试</a></p><a name=\"-code-setEndAfter(referenceNode)--code-\"></a><h3 id=\"0f95a58d\"><code>setEndAfter(referenceNode)</code></h3><p><br /></p><p>相对于另一个节点来设置拖蓝的结束位置，该拖蓝的结束节点与另一个节点的父节点是同一个，结束节点在另一个节点之后.</p><p><br /></p><p><img src=\"https://gitee.com/hjb2722404/tuchuang/raw/master/img/20201210154942.gif#alt=\" style=\"max-width: 600px;\" /></p><p><br /></p><p><a href=\"https://codesandbox.io/s/rangeapisetendafter-ngxx8?fontsize=14&amp;hidenavigation=1&amp;theme=dark\" target=\"_blank\"><img src=\"https://codesandbox.io/static/img/play-codesandbox.svg#alt=Edit%20rangeAPI_setEndAfter\" style=\"max-width: 600px;\" /></a></p><a name=\"-code-seelctNode(referenceNode)--code-\"></a><h3 id=\"b0bb6890\"><code>seelctNode(referenceNode)</code></h3><p><br /></p><p>将拖蓝设置为包含整个节点及其内容， 拖蓝的起始和结束节点的父节点与传入节点（<code>referenceNode</code>）的父节点相同。</p><p><br /></p><p><img src=\"https://gitee.com/hjb2722404/tuchuang/raw/master/img/20201210154959.gif#alt=\" style=\"max-width: 600px;\" /></p><p><br /></p><p><a href=\"https://codesandbox.io/s/rangeapiselectnode-uiipq?fontsize=14&amp;hidenavigation=1&amp;theme=dark\" target=\"_blank\"><img src=\"https://codesandbox.io/static/img/play-codesandbox.svg#alt=Edit%20rangeAPI_selectNode\" style=\"max-width: 600px;\" /></a></p><a name=\"-code-selectNodeContents(referenceNode)--code-\"></a><h3 id=\"1cde942a\"><code>selectNodeContents(referenceNode)</code></h3><p><br /></p><p>设置拖蓝，使其包含传入节点的内容，拖蓝的起始和结束节点的父节点即为传入的节点。</p><p><br /></p><p><img src=\"https://gitee.com/hjb2722404/tuchuang/raw/master/img/20201210155013.gif#alt=\" style=\"max-width: 600px;\" /></p><p><br /></p><p><a href=\"https://codesandbox.io/s/rangeapiselectnodecontents-1rru5?fontsize=14&amp;hidenavigation=1&amp;theme=dark\" target=\"_blank\"><img src=\"https://codesandbox.io/static/img/play-codesandbox.svg#alt=Edit%20rangeAPI_selectNodeContents\" style=\"max-width: 600px;\" /></a></p><a name=\"-code-collapse(toStart)--code-\"></a><h3 id=\"02f297bd\"><code>collapse(toStart)</code></h3><p><br /></p><p>闭合拖蓝。<code>toStart</code>: 闭合方向，<code>true</code>向起点闭合，<code>false</code>向终点闭合。</p><p><br /></p><p><img src=\"https://gitee.com/hjb2722404/tuchuang/raw/master/img/20201210155024.gif#alt=\" style=\"max-width: 600px;\" /></p><p><br /></p><p><a href=\"https://codesandbox.io/s/rangeapicollapse-5qvgs?fontsize=14&amp;hidenavigation=1&amp;theme=dark\" target=\"_blank\"><img src=\"https://codesandbox.io/static/img/play-codesandbox.svg#alt=Edit%20rangeAPI_collapse\" style=\"max-width: 600px;\" /></a></p><a name=\"-code-cloneContents()--code-\"></a><h3 id=\"67719b49\"><code>cloneContents()</code></h3><p><br /></p><p>返回包含拖蓝中所有节点的文档片段</p><p><br /></p><p><img src=\"https://gitee.com/hjb2722404/tuchuang/raw/master/img/20201210155040.gif#alt=\" style=\"max-width: 600px;\" /></p><p><br /></p><p><a href=\"https://codesandbox.io/s/rangeapiclonecontents-7orr6?fontsize=14&amp;hidenavigation=1&amp;theme=dark\" target=\"_blank\"><img src=\"https://codesandbox.io/static/img/play-codesandbox.svg#alt=Edit%20rangeAPI_cloneContents\" style=\"max-width: 600px;\" /></a></p><a name=\"-code-deleteContents()--code-\"></a><h3 id=\"02af6697\"><code>deleteContents()</code></h3><p><br /></p><p>从文档中移除拖蓝包含的内容</p><p><br /></p><p><img src=\"https://gitee.com/hjb2722404/tuchuang/raw/master/img/20201210155057.gif#alt=\" style=\"max-width: 600px;\" /></p><p><br /></p><p><a href=\"https://codesandbox.io/s/rangeapideletecontents-forked-ccil7?fontsize=14&amp;hidenavigation=1&amp;theme=dark\" target=\"_blank\"><img src=\"https://codesandbox.io/static/img/play-codesandbox.svg#alt=Edit%20rangeAPI_deleteContents%20%28forked%29\" style=\"max-width: 600px;\" /></a></p><a name=\"-code-extractContents()--code-\"></a><h3 id=\"183269ab\"><code>extractContents()</code></h3><p><br /></p><p>把拖蓝的内容从文档树移动到一个文档片段中，返回该文档片段</p><p><br /></p><p><img src=\"https://gitee.com/hjb2722404/tuchuang/raw/master/img/20201210155109.gif#alt=\" style=\"max-width: 600px;\" /></p><p><br /></p><p><a href=\"https://codesandbox.io/s/rangeapiextractcontents-zk6q6?fontsize=14&amp;hidenavigation=1&amp;theme=dark\" target=\"_blank\"><img src=\"https://codesandbox.io/static/img/play-codesandbox.svg#alt=Edit%20rangeAPI_extractContents\" style=\"max-width: 600px;\" /></a></p><a name=\"-code-insertNode(newNode)--code-\"></a><h3 id=\"397f24d9\"><code>insertNode(newNode)</code></h3><p><br /></p><p>在拖蓝的起始位置插入一个新的节点，如果将新节点添加到一个文本节点，则该文本节点在插入点处被拆分，插入发生在两个文本节点之间；如果新节点是一个文档片段，则插入文档片段的子节点。</p><p><br /></p><p><img src=\"https://gitee.com/hjb2722404/tuchuang/raw/master/img/20201210155128.gif#alt=\" style=\"max-width: 600px;\" /></p><p><br /></p><p><a href=\"https://codesandbox.io/s/rangeapiinsertnode-8fps2?fontsize=14&amp;hidenavigation=1&amp;theme=dark\" target=\"_blank\"><img src=\"https://codesandbox.io/static/img/play-codesandbox.svg#alt=Edit%20rangeAPI_insertNode\" style=\"max-width: 600px;\" /></a></p><a name=\"-code-surroundContents(newParent)--code-\"></a><h3 id=\"5e12b18a\"><code>surroundContents(newParent)</code></h3><p><br /></p><p>将拖蓝的内容移动到一个新的节点，并将新节点放到这个范围的起始处。它会从DOM中删除新节点内容。</p><p><br /></p><p><img src=\"https://gitee.com/hjb2722404/tuchuang/raw/master/img/20201210155200.gif#alt=\" style=\"max-width: 600px;\" /></p><p><br /></p><p><a href=\"https://codesandbox.io/s/rangeapisurroundcontents-6vo9d?fontsize=14&amp;hidenavigation=1&amp;theme=dark\" target=\"_blank\"><img src=\"https://codesandbox.io/static/img/play-codesandbox.svg#alt=Edit%20rangeAPI_surroundContents\" style=\"max-width: 600px;\" /></a></p><a name=\"-code-compareBoundaryPoints(how--sourceRange)--code-\"></a><h3 id=\"f72b65a0\"><code>compareBoundaryPoints(how, sourceRange)</code></h3><p><br /></p><p>比较两个拖蓝的端点。 <code>how</code>：指定如何比较，参见本表下方<code>how</code>部分。<code>sourceRange</code> : 要与之比较的拖蓝，返回一个数字，<code>-1/0/1</code>中的一个，表示本拖蓝的指定端点在源拖蓝的指定端点前面，相同位置还是后面。</p><p><br /></p><a name=\"-code-how--code-\"></a><h4 id=\"d5c4592e\"><code>how</code></h4><p><br /></p><p>指定如何比较，有四个可选值：</p><p><br /></p><ul><li><code>Range.END_TO_END</code>:  比较源拖蓝的终点与本拖蓝的终点</li></ul><ul><li><code>Range.END_TO_START</code>: 比较源拖蓝的终点与本拖蓝的起点</li></ul><ul><li><code>Range.START_TO_END</code>: 比较源拖蓝的起点与本拖蓝的终点</li></ul><ul><li><code>Range.START_TO_START</code>: 比较源拖蓝的起点与本拖蓝的起点</li></ul><p><br /></p><p><img src=\"https://raw.githubusercontent.com/hjb2722404/myimg/master/20200910092954.gif#alt=\" style=\"max-width: 600px;\" /></p><p><br /></p><p><a href=\"https://codesandbox.io/s/rangeapicompareboundarypoints-71bx7?fontsize=14&amp;hidenavigation=1&amp;theme=dark\" target=\"_blank\"><img src=\"https://codesandbox.io/static/img/play-codesandbox.svg#alt=Edit%20rangeAPI_compareBoundaryPoints\" style=\"max-width: 600px;\" /></a></p>",
  "slug": 80566329,
  "title": "富文本编辑器开发系列6——浏览器拖蓝RangeAPI探究"
}